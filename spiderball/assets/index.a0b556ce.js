var I=Object.defineProperty;var E=(n,e,s)=>e in n?I(n,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[e]=s;var r=(n,e,s)=>(E(n,typeof e!="symbol"?e+"":e,s),s);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const l of t)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function s(t){const l={};return t.integrity&&(l.integrity=t.integrity),t.referrerpolicy&&(l.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?l.credentials="include":t.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(t){if(t.ep)return;t.ep=!0;const l=s(t);fetch(t.href,l)}})();const f=["3a2646254635563556245f245f4039403f295a29,","33263d263d3042324525421f321f2e22303b253b251b2f1241114a174e26483c343838292a32,431a","3253311e631e635335395d3b,393542354c355735","30303019461a46264a35473a46493445353f413f41393d353f2439253930342b3842,4431","40303e244a1d59265839513950354835493c413c40325032503049214436,472c","32245724572862286230392f3a366336634e324e32455844583e323e5b2a3749,3d2b4638603e50264e48","34233d23402f4039453945324032402f4e2f4e33493349385138513e573e574a4c4a4b434542453c373c39275146,4a3c","46304e304d3c424a36492f442d322520260c2e063a0447104a07550a5516481c39142e1732243731383d3f404a334e0d,33382f2a2a1b350c","282b7d2b7d3228322c2e782e,602e512e422e322e","11150e1e182a2b39404157436b427c3c7e3377316d3d6741613e633c663e71366f3368345f37573c53394d364839503c463c3e3848394d36352e32322e362c342f303232352e2e2b252b1c1f1a17161b7935,3539"],w=800,S=600,g=30,m=20,X=60,M=1e3/X;class h{constructor(e,s){this.x=e,this.y=s}distanceTo(e){const s=e.x-this.x,o=e.y-this.y;return Math.sqrt(s*s+o*o)}}class k extends h{constructor(e,s,o){super(e,s),this.velocityX=o}contains(e){return this.distanceTo(e)<=g}drawCircle(e){e.beginPath(),e.arc(this.x,this.y,g,0,2*Math.PI)}draw(e){e.lineWidth=14,e.strokeStyle="#101010",e.translate(4,4),this.drawCircle(e),e.stroke(),e.translate(-4,-4),e.fillStyle="#404040",this.drawCircle(e),e.fill()}}class K{constructor(e){this.points=e}drawPath(e){e.beginPath();let s=!0;for(const o of this.points)s?e.moveTo(o.x,o.y):e.lineTo(o.x,o.y),s=!1;e.closePath()}contains(e){const s=this.points;let o=!1;for(let t=0,l=s.length-1;t<s.length;t++)s[t].y>e.y!=s[l].y>e.y&&e.x<(s[l].x-s[t].x)*(e.y-s[t].y)/(s[l].y-s[t].y)+s[t].x&&(o=!o),l=t;return o}}class x extends h{constructor(s){super(0,0);r(this,"velocity",new h(0,0));r(this,"attached",!1);this.style=s}shoot(s,o,t){this.x=s.x,this.y=s.y,this.velocity.x=o,this.velocity.y=t,this.attached=!1}draw(s,o){s.lineWidth=1,s.strokeStyle="white",s.beginPath(),s.arc(this.x,this.y,5,0,2*Math.PI),s.stroke(),s.strokeStyle=this.style,s.beginPath(),s.moveTo(this.x,this.y),s.lineTo(o.x,o.y),s.stroke()}}const T=[["black",0,0,10,10],["#0077ff",0,0,9,9],["#00ccff",-1,-1.5,7,6.5],["#aaf9ff",-2,-2.5,5,4.5]];class B extends h{constructor(){super(0,0);r(this,"velocity",new h(0,0));r(this,"ropes",[new x("orange"),new x("red")])}draw(s){for(const o of this.ropes)o.draw(s,this);for(const[o,t,l,c,y]of T)s.fillStyle=o,s.beginPath(),s.ellipse(this.x+t,this.y+l,c,y,0,0,2*Math.PI),s.fill()}}function P(n){const e=[];if(n.length%4!==0)throw new Error("invalid input: "+n);for(let s=0;s<n.length;s+=4)e.push(new h(parseInt(n.substring(s,s+2),16)*16,parseInt(n.substring(s+2,s+4),16)*16));return e}class L{constructor(e){r(this,"player",new B);r(this,"levelPolygon");r(this,"obstacles",[]);r(this,"target");r(this,"origin");this.levelString=e;const[s,o]=e.split(","),t=P(s);this.target=t.pop();const l=this.player,c=t.pop();l.x=c.x,l.y=c.y,this.origin=new h(l.x-w/2,l.y-(S/2+100)),this.levelPolygon=new K(t);for(const u of P(o!=null?o:""))this.obstacles.push(new k(u.x,u.y,1));const y=l.ropes;y[0].shoot(l,-5,-5),y[1].shoot(l,5,-5)}draw(e){e.save(),e.translate(-this.origin.x,-this.origin.y),e.lineWidth=14,e.strokeStyle="#101010",e.translate(-5,-5),this.levelPolygon.drawPath(e),e.stroke(),e.translate(5,5),e.fillStyle="#758085",this.levelPolygon.drawPath(e),e.fill(),e.lineWidth=1,e.strokeStyle="#ffcc00",e.beginPath(),e.arc(this.target.x,this.target.y,m+5,0,2*Math.PI),e.stroke(),e.beginPath(),e.arc(this.target.x,this.target.y,m,0,2*Math.PI),e.stroke();for(const s of this.obstacles)s.draw(e);this.player.draw(e),e.restore()}}class Y{constructor(e){r(this,"ctx");r(this,"playing",!0);r(this,"success",!1);r(this,"pressedKeys",new Set);r(this,"mouseX",0);r(this,"mouseY",0);r(this,"pressedMouseButtons",new Set);r(this,"nextLevelString",f[0]);r(this,"level");r(this,"levelStartMillis");r(this,"steps",0);this.canvas=e;const s=e==null?void 0:e.getContext("2d");if(!s)throw new Error("context 2d is not available");this.ctx=s,this.startLevel()}get levelIdx(){var e,s;return f.indexOf((s=(e=this.level)==null?void 0:e.levelString)!=null?s:"")}get levelMillis(){return this.steps*M}startLevel(){try{this.level=new L(this.nextLevelString)}catch{this.nextLevelString=f[0],this.level=new L(this.nextLevelString)}this.playing=!0,this.success=!1,this.levelStartMillis=void 0,this.steps=0}startLevelIfNotPlaying(){this.playing||(this.pressedKeys.clear(),this.pressedMouseButtons.clear(),this.startLevel())}setNextLevelString(e){this.nextLevelString=e,this.playing=!1,this.success=!0}step(){const e=this.level;if(e&&this.playing){const s=this.mouseX+e.origin.x,o=this.mouseY+e.origin.y,t=e.player,l=t.ropes,c=e.levelPolygon;e.origin.x+=(-e.origin.x+t.x-w/2)/30,e.origin.y+=(-e.origin.y+t.y-S/2)/30,this.pressedKeys.delete("KeyZ")&&this.pressedMouseButtons.add(0),this.pressedKeys.delete("KeyX")&&this.pressedMouseButtons.add(2),(this.pressedKeys.delete("KeyC")||this.pressedMouseButtons.has(1))&&(this.pressedMouseButtons.add(0),this.pressedMouseButtons.add(2));const y=this.pressedMouseButtons.has(0),u=this.pressedMouseButtons.has(2);if(this.pressedMouseButtons.clear(),y||u){const i=Math.atan2(o-t.y,s-t.x),a=13*Math.cos(i),d=13*Math.sin(i);y&&l[0].shoot(t,a,d),u&&l[1].shoot(t,a,d)}for(const i of l)!c.contains(i)&&!c.contains(new h(i.x+5,i.y+5))&&(i.attached=!0,i.velocity.x=0);!c.contains(t)&&!c.contains(new h(t.x+5,t.y+5))&&(this.playing=!1);for(const i of e.obstacles){c.contains(new h(i.x+g+60*Math.sign(i.velocityX),i.y+g))||(i.velocityX*=-1);for(const a of l)if(i.contains(a))if(!a.attached)a.attached=i;else{const d=Math.atan2(a.y-t.y,a.x-t.x);i.velocityX+=-t.distanceTo(a)/1500*Math.cos(d)}i.contains(new h(t.x,t.y))&&(this.playing=!1),i.velocityX*=.997;for(const a of l)a.attached===i&&(a.velocity.x=i.velocityX);i.x+=i.velocityX}for(const i of l){const a=Math.atan2(i.y-t.y,i.x-t.x),d=t.distanceTo(i);let p;i.attached?(i.x+=i.velocity.x,p=1500):(i.x+=i.velocity.x,i.y+=i.velocity.y,i.velocity.x*=.992,i.velocity.y*=.992,i.velocity.y+=.09,i.velocity.x+=-d/1500*Math.cos(a),i.velocity.y+=-d/1500*Math.sin(a),p=4e3),t.velocity.x+=d/p*Math.cos(a),t.velocity.y+=d/p*Math.sin(a)}t.velocity.y+=.09,t.velocity.x*=.98,t.velocity.y*=.98,t.x+=t.velocity.x,t.y+=t.velocity.y,t.distanceTo(e.target)<m&&this.setNextLevelString(f[(this.levelIdx+1)%f.length]),this.pressedKeys.delete("KeyR")&&(this.playing=!1),this.pressedKeys.delete("KeyW")&&this.setNextLevelString(f[Math.min(this.levelIdx+1,f.length-1)]),this.pressedKeys.delete("KeyQ")&&this.setNextLevelString(f[Math.max(this.levelIdx-1,0)]),++this.steps}}render(){const e=this.ctx;e.save(),e.fillStyle="#303030",e.fillRect(0,0,w,S);const s=this.level;s&&s.draw(e),e.fillStyle="#ffffff",e.font="16px sans-serif",e.fillText(this.levelIdx+1+": "+(this.levelMillis/1e3).toFixed(1)+"s",15,30),this.playing||(e.fillStyle="#ffffff",e.font="16px sans-serif",this.success?e.fillText("Level passed - click to begin",320,300):e.fillText("Game over - click to begin",330,300)),e.restore()}stepAndRender(e){if(this.playing){this.levelStartMillis===void 0&&(this.levelStartMillis=e);let s=M;for(;this.playing&&this.levelMillis-s<=e-this.levelStartMillis;)this.step(),s=0}this.render()}}const v=document.querySelector("canvas#canvas"),b=document.querySelector("body");if(v&&b){let n=function(t){document.visibilityState==="visible"&&e.stepAndRender(t),window.requestAnimationFrame(n)};const e=new Y(v);b.addEventListener("keydown",t=>{t.repeat||e.pressedKeys.add(t.code)}),b.addEventListener("keyup",t=>{e.pressedKeys.delete(t.code)}),v.addEventListener("mousedown",t=>{e.pressedMouseButtons.add(t.button),e.mouseX=t.offsetX,e.mouseY=t.offsetY,e.startLevelIfNotPlaying()}),v.addEventListener("mousemove",t=>{e.mouseX=t.offsetX,e.mouseY=t.offsetY}),v.addEventListener("contextmenu",t=>{t.preventDefault()});const s=document.querySelector("input#levelInput"),o=document.querySelector("button#load");o==null||o.addEventListener("click",()=>{const t=s==null?void 0:s.value;t&&e.setNextLevelString(t.trim())}),window.requestAnimationFrame(n)}
